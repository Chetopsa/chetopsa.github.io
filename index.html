
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Base64 Image Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Segoe UI Emoji", "Apple Color Emoji"; }
    body { margin: 0; background: #0b0c10; color: #e8eaed; }
    .wrap { max-width: 920px; margin: 32px auto; padding: 0 16px; }
    h1 { font-size: 1.4rem; margin: 0 0 12px; }
    .card { background: #15171b; border: 1px solid #2a2f36; border-radius: 14px; padding: 16px; box-shadow: 0 4px 16px rgba(0,0,0,.25); }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    textarea { width: 100%; min-height: 180px; resize: vertical; box-sizing: border-box; color: inherit; background: #0e1116; border: 1px solid #2a2f36; border-radius: 10px; padding: 10px; }
    select, input[type="text"] { background: #0e1116; color: inherit; border: 1px solid #2a2f36; border-radius: 10px; padding: 8px 10px; }
    button { background: #2563eb; color: #fff; border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .imgWrap { margin-top: 16px; display: grid; gap: 10px; }
    .meta { font-size: .9rem; opacity: .85; }
    .imgBox { overflow: auto; background: #0e1116; border: 1px dashed #2a2f36; border-radius: 12px; padding: 12px; }
    img { max-width: 100%; height: auto; display: block; image-rendering: -webkit-optimize-contrast; }
    .help { font-size: .9rem; opacity: .8; margin-top: 8px; }
    .small { font-size: .85rem; opacity: .8; }
    .inline { display: inline-flex; gap: 8px; align-items: center; }
    .monospace { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Base64 Image Viewer</h1>

    <div class="card">
      <label for="b64" class="small">Paste Base64 below (with or without <span class="monospace">data:image/*;base64,</span>)</label>
      <textarea id="b64" placeholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA... OR just the raw base64"></textarea>

      <div class="row" style="margin-top:10px">
        <label class="inline small" for="mime">MIME type (used only if your string lacks a data: prefix)</label>
        <select id="mime">
          <option value="image/png">image/png</option>
          <option value="image/jpeg">image/jpeg</option>
          <option value="image/webp">image/webp</option>
          <option value="image/gif">image/gif</option>
          <option value="image/svg+xml">image/svg+xml</option>
          <option value="image/bmp">image/bmp</option>
          <option value="image/x-icon">image/x-icon</option>
          <option value="image/heic">image/heic</option>
        </select>
        <button id="showBtn">Show image</button>
        <button id="clearBtn" style="background:#374151">Clear</button>
        <input id="fileInput" type="file" accept=".txt" title="Load Base64 from text file" />
      </div>

      <div class="help">
        Tip: If you already have a full data URL, you can use it directly in HTML:
        <div class="monospace small">&lt;img src="data:image/png;base64,AAA..." /&gt;</div>
      </div>

      <div class="imgWrap">
        <div class="meta" id="meta"></div>
        <div class="imgBox" id="imgBox" hidden>
          <img id="preview" alt="Decoded Base64 preview" />
        </div>
        <div id="actions" class="row" hidden>
          <button id="downloadBtn" title="Download decoded image">Download</button>
          <input id="nameInput" type="text" placeholder="filename (optional, e.g. image.png)" />
          <span class="small" id="dimInfo"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const ta = document.getElementById('b64');
    const mimeSel = document.getElementById('mime');
    const showBtn = document.getElementById('showBtn');
    const clearBtn = document.getElementById('clearBtn');
    const fileInput = document.getElementById('fileInput');
    const img = document.getElementById('preview');
    const imgBox = document.getElementById('imgBox');
    const meta = document.getElementById('meta');
    const actions = document.getElementById('actions');
    const downloadBtn = document.getElementById('downloadBtn');
    const nameInput = document.getElementById('nameInput');
    const dimInfo = document.getElementById('dimInfo');

    function isDataUrl(s) {
      return /^data:image\/[a-z0-9.+-]+;base64,/i.test(s.trim());
    }

    function buildDataUrl(s, mime) {
      const trimmed = s.trim();
      if (isDataUrl(trimmed)) return trimmed;
      return `data:${mime};base64,${trimmed}`;
    }

    function estimateBytesFromBase64(b64) {
      const s = b64.replace(/^data:[^,]+,/, '').trim();
      const pad = (s.endsWith('==') ? 2 : s.endsWith('=') ? 1 : 0);
      return Math.max(0, Math.floor(s.length * 3 / 4) - pad);
    }

    function humanBytes(n) {
      if (!isFinite(n)) return '';
      const u = ['B','KB','MB','GB','TB'];
      let i = 0, v = n;
      while (v >= 1024 && i < u.length-1) { v /= 1024; i++; }
      return `${v.toFixed(v >= 10 || v < 1 ? 1 : 2)} ${u[i]}`;
    }

    function showMsg(text, ok = true) {
      meta.textContent = text;
      meta.style.color = ok ? '#c9f7d5' : '#f8caca';
    }

    async function decodeAndShow() {
      const raw = ta.value;
      if (!raw.trim()) {
        showMsg('Paste a Base64 string first.', false);
        imgBox.hidden = true; actions.hidden = true;
        return;
      }
      const mime = mimeSel.value;
      const url = buildDataUrl(raw, mime);

      try {
        img.src = url;
        await img.decode?.(); // wait for render support
        imgBox.hidden = false;
        actions.hidden = false;

        const size = estimateBytesFromBase64(url);
        const dims = `${img.naturalWidth || '?'}×${img.naturalHeight || '?'}`;
        dimInfo.textContent = `Dimensions: ${dims}`;
        showMsg(`Loaded image • ~${humanBytes(size)} • ${isDataUrl(raw) ? 'data URL detected' : `assumed ${mime}`}`);
      } catch (e) {
        imgBox.hidden = true; actions.hidden = true;
        showMsg(`Could not decode image: ${e?.message || e}`, false);
      }
    }

    showBtn.addEventListener('click', decodeAndShow);
    clearBtn.addEventListener('click', () => {
      ta.value = '';
      img.src = '';
      imgBox.hidden = true;
      actions.hidden = true;
      showMsg('Cleared.');
      dimInfo.textContent = '';
      nameInput.value = '';
    });

    fileInput.addEventListener('change', async (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const txt = await f.text();
      ta.value = txt;
      decodeAndShow();
    });

    downloadBtn.addEventListener('click', () => {
      const url = img.src;
      if (!url) return;
      const a = document.createElement('a');
      let name = nameInput.value.trim();
      if (!name) {
        const ext = (url.match(/^data:image\/([^;]+)/i)?.[1] || 'png')
          .replace('svg+xml','svg').replace('x-icon','ico');
        name = `image.${ext}`;
      }
      a.href = url;
      a.download = name;
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // Drag & drop support for Base64 text
    document.addEventListener('dragover', (e) => { e.preventDefault(); });
    document.addEventListener('drop', async (e) => {
      e.preventDefault();
      const item = [...(e.dataTransfer.items || [])].find(i => i.kind === 'string' || i.kind === 'file');
      if (!item) return;
      if (item.kind === 'string') {
        item.getAsString((s) => { ta.value = s; decodeAndShow(); });
      } else if (item.kind === 'file') {
        const file = item.getAsFile();
        if (file) {
          const txt = await file.text();
          ta.value = txt;
          decodeAndShow();
        }
      }
    });
  </script>
</body>
</html>

</body>
</html>
